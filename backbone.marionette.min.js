// Backbone.Marionette v0.3.0
//
// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT License
//
// Documentation and Full License Available at:
// http://github.com/derickbailey/backbone.marionette
Backbone.Marionette=function(c,e,f){var d={version:"0.3.1",RegionManager:function(a){this.options=a||{};if(!this.el)throw a=Error("An 'el' must be specified"),a.name="NoElError",a;this.$el=f(this.el)}};e.extend(d.RegionManager.prototype,c.Events,{show:function(a){var b=this.currentView;this.currentView=a;this._closeView(b);this._openView(a)},_closeView:function(a){a&&a.close&&a.close()},_openView:function(a){a.render();this.$el.html(a.el);if(a.onShow)a.onShow()}});d.ItemView=c.View.extend({constructor:function(){var a=
j.call(arguments);c.View.prototype.constructor.apply(this,a);this.$el||(this.$el=f(this.el));e.bindAll(this,"render")},serializeData:function(){var a;this.collection&&(a={},a.items=this.collection.toJSON());this.model&&(a=this.model.toJSON());return a},template:function(){return f(this.options.template)},render:function(){var a=this.getTemplate(),b=this.serializeData();this.$el.html(this.renderTemplate(a,b));if(this.onRender)this.onRender();return this},renderTemplate:function(a,b){if(!a||0===a.length){var d=
Error("A template must be specified");d.name="NoTemplateError";throw d;}return e.template(a.html(),b)},getTemplate:function(){var a=this.template;return e.isFunction(a)?a.call(this):d.TemplateManager.get(a)},close:function(){this.unbindAll();this.unbind();this.remove();if(this.onClose)this.onClose()}});d.CollectionView=c.View.extend({modelView:d.ItemView,constructor:function(){c.View.prototype.constructor.apply(this,arguments);this.$el||(this.$el=f(this.el));e.bindAll(this,"addChildView","render");
this.bindTo(this.collection,"add",this.addChildView,this);this.bindTo(this.collection,"remove",this.removeChildView,this)},render:function(){this.renderModel();this.collection.each(this.addChildView);if(this.onRender)this.onRender();return this},renderModel:function(){if(this.model){var a=new this.modelView({model:this.model,template:this.template});a.render();this.$el.append(a.el)}},addChildView:function(a){this.appendHtml(this.$el,this.renderItem(a))},removeChildView:function(a){var b=this.children[a.cid];
b&&(b.close(),delete this.children[a.cid])},appendHtml:function(a,b){a.append(b)},renderItem:function(a){if(!this.itemView)throw a=Error("An `itemView` must be specified"),a.name="NoItemViewError",a;a=new this.itemView({model:a});a.render();this.storeChild(a);return a.el},storeChild:function(a){this.children||(this.children={});this.children[a.model.cid]=a},close:function(){this.unbind();this.unbindAll();this.remove();this.children&&e.each(this.children,function(a){a.close()});if(this.onClose)this.onClose()}});
d.BindTo={bindTo:function(a,b,d,c){c=c||this;a.on(b,d,c);this.bindings||(this.bindings=[]);this.bindings.push({obj:a,eventName:b,callback:d,context:c})},unbindAll:function(){e.each(this.bindings,function(a){a.obj.off(a.eventName,a.callback)});this.bindings=[]}};d.AppRouter=c.Router.extend({constructor:function(a){c.Router.prototype.constructor.call(this,a);this.appRoutes&&this.processAppRoutes(a.controller,this.appRoutes)},processAppRoutes:function(a,b){var d,c,e,f,g=[];for(e in b)g.unshift([e,b[e]]);
f=g.length;for(var h=0;h<f;h++)e=g[h][0],c=g[h][1],d=a[c],this.route(e,c,d)}});d.Application=function(a){this.initializers=[];this.vent=e.extend({},c.Events,d.BindTo);e.extend(this,a)};e.extend(d.Application.prototype,c.Events,{addInitializer:function(a){this.initializers.push(a)},start:function(a){this.trigger("initialize:before",a);for(var b=0;b<this.initializers.length;b++)this.initializers[b].call(this,a);this.trigger("initialize:after",a)},addRegions:function(a){var b,c;for(c in a)a.hasOwnProperty(c)&&
(b=a[c],b="string"===typeof b?d.RegionManager.extend({el:b}):b,this[c]=new b)}});d.TemplateManager={templates:{},get:function(a){var b=this.templates[a];b||(b=this.loadTemplate(a),this.templates[a]=b);return b},loadTemplate:function(a){return f(a)},clear:function(){var a=arguments.length;if(1<a)for(var b=0;b<a;b++)delete this.templates[arguments[b]];else this.templates={}}};var j=Array.prototype.slice,i=c.View.extend;d.RegionManager.extend=i;d.Application.extend=i;e.extend(d.ItemView.prototype,d.BindTo);
e.extend(d.CollectionView.prototype,d.BindTo);e.extend(d.Application.prototype,d.BindTo);c.Events.on||e.each([c.Events,c.View.prototype,c.Model.prototype,c.Collection.prototype,c.Router.prototype],function(a){a.on=c.Events.bind;a.off=c.Events.unbind});return d}(Backbone,_,window.jQuery||window.Zepto||window.ender);
