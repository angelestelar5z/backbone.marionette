// Backbone.Marionette v0.2.6
//
// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT License
//
// Documentation and Full License Available at:
// http://github.com/derickbailey/backbone.marionette
Backbone.Marionette=function(d,c,f){var b={version:"0.2.6",RegionManager:function(a){this.options=a||{};if(!this.el)throw a=Error("An 'el' must be specified"),a.name="NoElError",a;this.el=f(this.el)}};c.extend(b.RegionManager.prototype,d.Events,{show:function(a){var e=this.currentView;this.currentView=a;this._closeView(e);this._openView(a)},_closeView:function(a){a&&a.close&&a.close()},_openView:function(a){a.render();this.el.html(a.el);if(a.onShow)a.onShow()}});b.ItemView=d.View.extend({constructor:function(){var a=
j.call(arguments);d.View.prototype.constructor.apply(this,a);this.el=f(this.el);c.bindAll(this,"render")},serializeData:function(){var a;if(this.collection)a={},a.items=this.collection.toJSON();this.model&&(a=this.model.toJSON());return a},template:function(){return f(this.options.template)},render:function(){var a=this.getTemplate(),e=this.serializeData();this.el.html(this.renderTemplate(a,e));if(this.onRender)this.onRender();return this},renderTemplate:function(a,e){if(!a||0===a.length){var b=Error("A template must be specified");
b.name="NoTemplateError";throw b;}return c.template(a.html(),e)},getTemplate:function(){var a=this.template;return c.isFunction(a)?a.call(this):b.TemplateManager.get(a)},close:function(){this.unbindAll();this.unbind();this.remove();if(this.onClose)this.onClose()}});b.CollectionView=d.View.extend({itemView:b.ItemView,modelView:b.ItemView,constructor:function(){d.View.prototype.constructor.apply(this,arguments);this.el=f(this.el);c.bindAll(this,"addChildView","render");this.bindTo(this.collection,"add",
this.addChildView,this);this.bindTo(this.collection,"remove",this.removeChildView,this)},render:function(){this.renderModel();this.collection.each(this.addChildView);if(this.onRender)this.onRender();return this},renderModel:function(){if(this.model){var a=new this.modelView({model:this.model,template:this.template});a.render();this.el.append(a.el)}},addChildView:function(a){this.appendHtml(this.el,this.renderItem(a))},removeChildView:function(a){var e=this.children[a.cid];e&&(e.close(),delete this.children[a.cid])},
appendHtml:function(a,e){a.append(e)},renderItem:function(a){a=new this.itemView({model:a});a.render();this.storeChild(a);return a.el},storeChild:function(a){if(!this.children)this.children={};this.children[a.model.cid]=a},close:function(){this.unbind();this.unbindAll();this.remove();this.children&&c.each(this.children,function(a){a.close()});if(this.onClose)this.onClose()}});b.BindTo={bindTo:function(a,e,b,c){c=c||this;a.bind(e,b,c);if(!this.bindings)this.bindings=[];this.bindings.push({obj:a,eventName:e,
callback:b,context:c})},unbindAll:function(){c.each(this.bindings,function(a){a.obj.unbind(a.eventName,a.callback)});this.bindings=[]}};b.AppRouter=d.Router.extend({constructor:function(a){d.Router.prototype.constructor.call(this,a);this.appRoutes&&this.processAppRoutes(a.controller,this.appRoutes)},processAppRoutes:function(a,e){var b,c,d,f,g=[];for(d in e)g.unshift([d,e[d]]);f=g.length;for(var h=0;h<f;h++)d=g[h][0],c=g[h][1],b=a[c],this.route(d,c,b)}});b.Application=function(a){this.initializers=
[];this.vent=c.extend({},d.Events,b.BindTo);c.extend(this,a)};c.extend(b.Application.prototype,d.Events,{addInitializer:function(a){this.initializers.push(a)},start:function(a){this.trigger("initialize:before",a);for(var b=0;b<this.initializers.length;b++)this.initializers[b].call(this,a);this.trigger("initialize:after",a)},addRegions:function(a){if(!this.regions)this.regions={},this.addInitializer(c.bind(this._initializeRegions,this));var e=this.regions,d;for(d in a)if(a.hasOwnProperty(d)){var f=
a[d];e[d]="string"===typeof f?b.RegionManager.extend({el:f}):f}},_initializeRegions:function(){if(this.regions)for(var a in this.regions)this.regions.hasOwnProperty(a)&&(this[a]=new this.regions[a])}});b.TemplateManager={templates:{},get:function(a){var b=this.templates[a];b||(b=this.loadTemplate(a),this.templates[a]=b);return b},loadTemplate:function(a){return f(a)},clear:function(){var a=arguments.length;if(1<a)for(var b=0;b<a;b++)delete this.templates[arguments[b]];else this.templates={}}};var j=
Array.prototype.slice,i=d.View.extend;b.RegionManager.extend=i;b.Application.extend=i;c.extend(b.ItemView.prototype,b.BindTo);c.extend(b.CollectionView.prototype,b.BindTo);c.extend(b.Application.prototype,b.BindTo);return b}(Backbone,_,window.jQuery||window.Zepto||window.ender);
