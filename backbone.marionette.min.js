// Backbone.Marionette v0.3.0
//
// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT License
//
// Documentation and Full License Available at:
// http://github.com/derickbailey/backbone.marionette
Backbone.Marionette=function(b,e,f){var c={version:"0.3.0",RegionManager:function(a){this.options=a||{};if(!this.el)throw a=Error("An 'el' must be specified"),a.name="NoElError",a;this.$el=f(this.el)}};e.extend(c.RegionManager.prototype,b.Events,{show:function(a){var d=this.currentView;this.currentView=a;this._closeView(d);this._openView(a)},_closeView:function(a){a&&a.close&&a.close()},_openView:function(a){a.render();this.$el.html(a.el);if(a.onShow)a.onShow()}});c.ItemView=b.View.extend({constructor:function(){var a=
j.call(arguments);b.View.prototype.constructor.apply(this,a);this.$el||(this.$el=f(this.el));e.bindAll(this,"render")},serializeData:function(){var a;this.collection&&(a={},a.items=this.collection.toJSON());this.model&&(a=this.model.toJSON());return a},template:function(){return f(this.options.template)},render:function(){var a=this.getTemplate(),d=this.serializeData();this.$el.html(this.renderTemplate(a,d));if(this.onRender)this.onRender();return this},renderTemplate:function(a,d){if(!a||0===a.length){var c=
Error("A template must be specified");c.name="NoTemplateError";throw c;}return e.template(a.html(),d)},getTemplate:function(){var a=this.template;return e.isFunction(a)?a.call(this):c.TemplateManager.get(a)},close:function(){this.unbindAll();this.unbind();this.remove();if(this.onClose)this.onClose()}});c.CollectionView=b.View.extend({modelView:c.ItemView,constructor:function(){b.View.prototype.constructor.apply(this,arguments);this.$el||(this.$el=f(this.el));e.bindAll(this,"addChildView","render");
this.bindTo(this.collection,"add",this.addChildView,this);this.bindTo(this.collection,"remove",this.removeChildView,this)},render:function(){this.renderModel();this.collection.each(this.addChildView);if(this.onRender)this.onRender();return this},renderModel:function(){if(this.model){var a=new this.modelView({model:this.model,template:this.template});a.render();this.$el.append(a.el)}},addChildView:function(a){this.appendHtml(this.$el,this.renderItem(a))},removeChildView:function(a){var d=this.children[a.cid];
d&&(d.close(),delete this.children[a.cid])},appendHtml:function(a,d){a.append(d)},renderItem:function(a){if(!this.itemView)throw a=Error("An `itemView` must be specified"),a.name="NoItemViewError",a;a=new this.itemView({model:a});a.render();this.storeChild(a);return a.el},storeChild:function(a){this.children||(this.children={});this.children[a.model.cid]=a},close:function(){this.unbind();this.unbindAll();this.remove();this.children&&e.each(this.children,function(a){a.close()});if(this.onClose)this.onClose()}});
c.BindTo={bindTo:function(a,d,c,b){b=b||this;a.on(d,c,b);this.bindings||(this.bindings=[]);this.bindings.push({obj:a,eventName:d,callback:c,context:b})},unbindAll:function(){e.each(this.bindings,function(a){a.obj.off(a.eventName,a.callback)});this.bindings=[]}};c.AppRouter=b.Router.extend({constructor:function(a){b.Router.prototype.constructor.call(this,a);this.appRoutes&&this.processAppRoutes(a.controller,this.appRoutes)},processAppRoutes:function(a,d){var c,b,e,f,g=[];for(e in d)g.unshift([e,d[e]]);
f=g.length;for(var h=0;h<f;h++)e=g[h][0],b=g[h][1],c=a[b],this.route(e,b,c)}});c.Application=function(a){this.initializers=[];this.vent=e.extend({},b.Events,c.BindTo);e.extend(this,a)};e.extend(c.Application.prototype,b.Events,{addInitializer:function(a){this.initializers.push(a)},start:function(a){this.trigger("initialize:before",a);for(var d=0;d<this.initializers.length;d++)this.initializers[d].call(this,a);this.trigger("initialize:after",a)},addRegions:function(a){this.regions||(this.regions={},
this.addInitializer(e.bind(this._initializeRegions,this)));var d=this.regions,b;for(b in a)if(a.hasOwnProperty(b)){var f=a[b];d[b]="string"===typeof f?c.RegionManager.extend({el:f}):f}},_initializeRegions:function(){if(this.regions)for(var a in this.regions)this.regions.hasOwnProperty(a)&&(this[a]=new this.regions[a])}});c.TemplateManager={templates:{},get:function(a){var b=this.templates[a];b||(b=this.loadTemplate(a),this.templates[a]=b);return b},loadTemplate:function(a){return f(a)},clear:function(){var a=
arguments.length;if(1<a)for(var b=0;b<a;b++)delete this.templates[arguments[b]];else this.templates={}}};var j=Array.prototype.slice,i=b.View.extend;c.RegionManager.extend=i;c.Application.extend=i;e.extend(c.ItemView.prototype,c.BindTo);e.extend(c.CollectionView.prototype,c.BindTo);e.extend(c.Application.prototype,c.BindTo);b.Events.on||e.each([b.Events,b.View.prototype,b.Model.prototype,b.Collection.prototype,b.Router.prototype],function(a){a.on=b.Events.bind;a.off=b.Events.unbind});return c}(Backbone,
_,window.jQuery||window.Zepto||window.ender);
